!function(t){function e(){for(var t="",e=0;e<5;e++)t+=Math.ceil(15*Math.random()).toString(16);return t}function n(t,e,i,s,o){t[e]?i.apply(s):(o=o||0,o<1e3&&setTimeout(function(){n(t,e,i,s,o+1)},0))}function i(e){setTimeout(function(){var i=document.createElement("script");i.type="text/javascript",i.src=e||t.fastXDM.helperUrl,n(document,"body",function(){document.getElementsByTagName("HEAD")[0].appendChild(i)})},0)}function s(t,e){var n;switch(typeof t){case"string":n=e?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):t.replace(/&#039;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");break;case"object":if("[object Array]"===Object.prototype.toString.apply(t)){n=[];for(var i=0,o=t.length;i<o;i++)n[i]=s(t[i],e)}else{n={};for(var r in t)Object.hasOwnProperty.call(t,r)&&(n[r]=s(t[r],e))}break;default:n=t}return n}function o(t,e){p.loaded?t.apply(e,[p]):h.push([e,t])}function r(){p.loaded=!0;for(var t=0,e=h.length;t<e;t++)h[t][1].apply(h[t][0],[p])}function a(t,e){o(function(n){var i=n.json.parse(t);if(i[0]){i[1]||(i[1]=[]);for(var o=0,r=i[1].length;o<r;o++)if(i[1][o]&&i[1][o]._func){var a=i[1][o]._func;i[1][o]=function(){var t=Array.prototype.slice.call(arguments);t.unshift("_func"+a),e.callMethod.apply(e,t)}}else e.options.safe&&(i[1][o]=s(i[1][o],!0));setTimeout(function(){if(!e.methods[i[0]])throw Error("fastXDM: Method "+i[0]+" is undefined");e.methods[i[0]].apply(e,i[1])},0)}})}function f(t,e){for(var n in e)t[n]&&"object"==typeof t[n]?f(t[n],e[n]):t[n]=e[n]}if(!t.fastXDM){var c={},h=[],p={};t.fastXDM={_id:0,helperUrl:"https://vk.com/js/api/xdmHelper.js",Server:function(n,i,s){this.methods=n||{},this.filter=i,this.options=s||{},this.id=t.fastXDM._id++,this.key=e(),this.frameName="fXD"+this.key,this.server=!0,this.methods["%init%"]=this.methods.__fxdm_i=function(){t.fastXDM.run(this.id),this.methods.onInit&&this.methods.onInit()},c[this.key]=[a,this]},Client:function(e,n){if(this.methods=e||{},this.options=n||{},this.id=t.fastXDM._id++,this.client=!0,t.fastXDM.run(this.id),0!==window.name.indexOf("fXD"))throw Error("Wrong window.name property.");this.key=window.name.substr(3),this.caller=window.parent,c[this.key]=[a,this],t.fastXDM.on("helper",function(){t.fastXDM.onClientStart(this)},this),o(function(t){t.send(this,t.json.stringify(["%init%"]));var e=this.methods;setTimeout(function(){e.onInit&&e.onInit()},0)},this)},onMessage:function(t){var e=t.data;if(!e)return!1;if("string"!=typeof e&&!(e instanceof String))return!1;var n=e.substr(0,5);if(c[n]){var i=c[n][1];!i||i.filter&&!i.filter(t.origin)||c[n][0](e.substr(6),i)}},setJSON:function(t){p.json=t},getJSON:function(t){return t?void o(function(e){t(e.json)}):p.json},setEnv:function(t){for(var e in t)p[e]=t[e];r()},_q:{},on:function(t,e,n){this._q[t]||(this._q[t]=[]),this._q[t]==-1?e.apply(n):this._q[t].push([e,n])},run:function(t){for(var e=(this._q[t]||[]).length,n=0;n<e;n++)this._q[t][n][0].apply(this._q[t][n][1]);this._q[t]=-1},waitFor:n},t.fastXDM.Server.prototype.start=function(e,n){if(e.contentWindow)this.caller=e.contentWindow,this.frame=e,t.fastXDM.on("helper",function(){t.fastXDM.onServerStart(this)},this);else{var i=this;n=n||0,n<50&&setTimeout(function(){i.start.apply(i,[e,n+1])},100)}},t.fastXDM.Server.prototype.destroy=function(){delete c[this.key]},t.fastXDM.Server.prototype.append=function(t,e,n){var i=document.createElement("DIV");i.innerHTML='<iframe name="'+this.frameName+'" '+(n||"")+"></iframe>";var s=i.firstChild,o=this;return setTimeout(function(){s.frameBorder="0",e&&f(s,e),t.insertBefore(s,t.firstChild),o.start(s)},0),s},t.fastXDM.Client.prototype.callMethod=t.fastXDM.Server.prototype.callMethod=function(){for(var e=Array.prototype.slice.call(arguments),i=e.shift(),r=0,a=e.length;r<a;r++)if("function"==typeof e[r]){this.funcsCount=(this.funcsCount||0)+1;var f=e[r],c="_func"+this.funcsCount;this.methods[c]=function(){f.apply(this,arguments),delete this.methods[c]},e[r]={_func:this.funcsCount}}else this.options.safe&&(e[r]=s(e[r],!1));n(this,"caller",function(){t.fastXDM.on(this.id,function(){o(function(t){t.send(this,t.json.stringify([i,e]))},this)},this)},this)},t.JSON&&"object"==typeof t.JSON&&t.JSON.parse&&t.JSON.stringify&&'{"a":[1,2,3]}'===t.JSON.stringify({a:[1,2,3]}).replace(/ /g,"")?p.json={parse:t.JSON.parse,stringify:t.JSON.stringify}:t.fastXDM._needJSON=!0,t.postMessage?(p.protocol="p",p.send=function(t,e){var n=t.frame?t.frame.contentWindow:t.caller;if(n)try{n.postMessage(t.key+":"+e,"*")}catch(i){window.postMessage.call(n,t.key+":"+e,"*")}},t.addEventListener?t.addEventListener("message",t.fastXDM.onMessage,!1):t.attachEvent("onmessage",t.fastXDM.onMessage),t.fastXDM._needJSON?(t.fastXDM._onlyJSON=!0,i()):r()):i()}}(window);try{stManager.done("api/xdm.js")}catch(e){}
//# sourceMappingURL=maps/xdm.js.map
